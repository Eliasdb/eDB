date: invalid argument 's' for -I
# workbench-gadgets drop @ 
# BASE=http://127.0.0.1:9102

â€¢ Attempt to delete gadgets (if API is running)
jq: error (at <stdin>:0): Cannot iterate over null (null)
â€¢ Attempt to delete suppliers (if API is running)
jq: error (at <stdin>:0): Cannot iterate over null (null)
â€¢ Revert relationship gadgets -> suppliers

 NX  Generating @edb-workbench/plugin:workbench-api-rel

[workbench-api-rel] Reverted â†’ gadgets belongsTo suppliers (fk=supplierId)
UPDATE libs/server/workbench-api/models/src/contracts/gadget.contract.json
UPDATE libs/server/workbench-api/models/src/lib/gadget.model.ts
UPDATE libs/server/workbench-api/infra/src/lib/db/schema.gadgets.ts
UPDATE libs/server/workbench-api/infra/src/lib/repos/gadget.repo.pg.ts
UPDATE libs/server/workbench-api/infra/src/lib/repos/tests/gadget.repo.pg.spec.ts
UPDATE libs/server/workbench-api/resources/src/lib/gadgets/gadget.controller.ts
DELETE libs/server/workbench-api/resources/src/lib/gadgets/_includes.supplier.ts
UPDATE libs/server/workbench-api/resources/src/lib/register.ts
â€¢ Revert infra

 NX  Generating @edb-workbench/plugin:workbench-api-infra

[workbench-api-infra] Reverted â†’ gadgets
DELETE libs/server/workbench-api/infra/src/lib/db/schema.gadgets.ts
DELETE libs/server/workbench-api/infra/src/lib/repos/gadget.repo.pg.ts
DELETE libs/server/workbench-api/infra/src/lib/repos/tests/gadget.repo.pg.spec.ts
UPDATE libs/server/workbench-api/infra/src/index.ts
UPDATE libs/server/workbench-api/infra/src/lib/db/drizzle.ts
UPDATE libs/server/workbench-api/resources-pg/src/lib/index.ts

 NX  Generating @edb-workbench/plugin:workbench-api-infra

[workbench-api-infra] Reverted â†’ suppliers
DELETE libs/server/workbench-api/infra/src/lib/db/schema.suppliers.ts
DELETE libs/server/workbench-api/infra/src/lib/repos/supplier.repo.pg.ts
DELETE libs/server/workbench-api/infra/src/lib/repos/tests/supplier.repo.pg.spec.ts
UPDATE libs/server/workbench-api/infra/src/index.ts
UPDATE libs/server/workbench-api/infra/src/lib/db/drizzle.ts
UPDATE libs/server/workbench-api/resources-pg/src/lib/index.ts
â€¢ Revert resources

 NX  Generating @edb-workbench/plugin:workbench-api-resource

[workbench-api-resource] Reverted -> gadgets
UPDATE libs/server/workbench-api/resources/src/lib/register.ts
DELETE libs/server/workbench-api/resources/src/lib/gadgets/gadget.controller.ts
DELETE libs/server/workbench-api/resources/src/lib/gadgets/gadget.service.ts
DELETE libs/server/workbench-api/resources/src/lib/gadgets/index.ts
DELETE libs/server/workbench-api/resources/src/lib/gadgets

 NX  Generating @edb-workbench/plugin:workbench-api-resource

[workbench-api-resource] Reverted -> suppliers
UPDATE libs/server/workbench-api/resources/src/lib/register.ts
DELETE libs/server/workbench-api/resources/src/lib/suppliers/supplier.controller.ts
DELETE libs/server/workbench-api/resources/src/lib/suppliers/supplier.service.ts
DELETE libs/server/workbench-api/resources/src/lib/suppliers/index.ts
DELETE libs/server/workbench-api/resources/src/lib/suppliers
â€¢ Revert models

 NX  Generating @edb-workbench/plugin:workbench-api-model

[workbench-api-model] Reverted model 'gadget'
UPDATE libs/server/workbench-api/models/src/index.ts
DELETE libs/server/workbench-api/models/src/lib/gadget.model.ts
DELETE libs/server/workbench-api/models/src/contracts/gadget.contract.json

 NX  Generating @edb-workbench/plugin:workbench-api-model

[workbench-api-model] Reverted model 'supplier'
UPDATE libs/server/workbench-api/models/src/index.ts
DELETE libs/server/workbench-api/models/src/lib/supplier.model.ts
DELETE libs/server/workbench-api/models/src/contracts/supplier.contract.json
DELETE libs/server/workbench-api/models/src/contracts/.gitkeep
DELETE libs/server/workbench-api/models/src/contracts
â€¢ Generate + apply drop migrations (best-effort)

> nx run workbench-api-infra:"migrations:generate"

> drizzle-kit generate --config=drizzle.config.ts

[90mReading config file '/Users/elias/Documents/Projects/2025_2026/eDB/libs/server/workbench-api/infra/drizzle.config.ts'[39m
[1m4 tables[22m
[1m[22m[1m[34mauthors[39m[22m [90m7 columns 0 indexes 0 fks[39m
[1m[34mbooks[39m[22m [90m7 columns 0 indexes 1 fks[39m
[1m[34mbook_tags[39m[22m [90m3 columns 0 indexes 2 fks[39m
[1m[34mtags[39m[22m [90m4 columns 0 indexes 0 fks[39m

[[32mâœ“[39m] Your SQL migration file âžœ [1m[4m[34msrc/lib/migrations/0001_majestic_tony_stark.sql[39m[24m[22m ðŸš€



 NX   Successfully ran target migrations:generate for project workbench-api-infra


View logs and investigate cache misses at https://nx.app/runs/X5X1mCnwWT


> nx run workbench-api-infra:migrate

> node src/lib/db/runMigrations.local.cjs

ðŸ’¾ using DATABASE_URL = postgres://workbench_user:secret@127.0.0.1:5432/workbench_dev
â³ Applying 0000_fair_network.sql...
âŒ Migration failed: DrizzleQueryError: Failed query: CREATE TYPE "public"."gadgets_category_enum" AS ENUM('surveillance', 'infiltration', 'comms', 'medical');--> statement-breakpoint
CREATE TABLE "authors" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"first_name" text NOT NULL,
	"last_name" text NOT NULL,
	"bio" text,
	"is_active" boolean DEFAULT true NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "books" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"author_id" uuid NOT NULL,
	"title" text NOT NULL,
	"published_year" integer,
	"status" text DEFAULT 'draft' NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "book_tags" (
	"book_id" uuid NOT NULL,
	"tag_id" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "book_tags_book_id_tag_id_pk" PRIMARY KEY("book_id","tag_id")
);
--> statement-breakpoint
CREATE TABLE "gadgets" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" text NOT NULL,
	"category" "gadgets_category_enum" NOT NULL,
	"weight_gr" integer,
	"discontinued" boolean,
	"released_at" timestamp with time zone,
	"supplier_id" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "suppliers" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" text NOT NULL,
	"country" text,
	"rating" integer,
	"contact_email" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "tags" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"label" text NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "tags_label_unique" UNIQUE("label")
);
--> statement-breakpoint
ALTER TABLE "books" ADD CONSTRAINT "books_author_id_authors_id_fk" FOREIGN KEY ("author_id") REFERENCES "public"."authors"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "book_tags" ADD CONSTRAINT "book_tags_book_id_books_id_fk" FOREIGN KEY ("book_id") REFERENCES "public"."books"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "book_tags" ADD CONSTRAINT "book_tags_tag_id_tags_id_fk" FOREIGN KEY ("tag_id") REFERENCES "public"."tags"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "gadgets" ADD CONSTRAINT "gadgets_supplier_id_suppliers_id_fk" FOREIGN KEY ("supplier_id") REFERENCES "public"."suppliers"("id") ON DELETE cascade ON UPDATE cascade;
params: 
    at PostgresJsPreparedQuery.queryWithCache (/Users/elias/Documents/Projects/2025_2026/eDB/node_modules/[4m.pnpm[24m/drizzle-orm@0.44.6_@types+pg@8.15.5_pg@8.16.3_postgres@3.4.7/node_modules/[4mdrizzle-orm[24m/pg-core/session.cjs:66:15)
[90m    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at async main [90m(/Users/elias/Documents/Projects/2025_2026/eDB/libs/server/workbench-api/infra/[39msrc/lib/db/runMigrations.local.cjs:34:5[90m)[39m {
  query: [32m`CREATE TYPE "public"."gadgets_category_enum" AS ENUM('surveillance', 'infiltration', 'comms', 'medical');--> statement-breakpoint\n`[39m +
    [32m'CREATE TABLE "authors" (\n'[39m +
    [32m'\t"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n'[39m +
    [32m'\t"first_name" text NOT NULL,\n'[39m +
    [32m'\t"last_name" text NOT NULL,\n'[39m +
    [32m'\t"bio" text,\n'[39m +
    [32m'\t"is_active" boolean DEFAULT true NOT NULL,\n'[39m +
    [32m'\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n'[39m +
    [32m'\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL\n'[39m +
    [32m');\n'[39m +
    [32m'--> statement-breakpoint\n'[39m +
    [32m'CREATE TABLE "books" (\n'[39m +
    [32m'\t"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n'[39m +
    [32m'\t"author_id" uuid NOT NULL,\n'[39m +
    [32m'\t"title" text NOT NULL,\n'[39m +
    [32m'\t"published_year" integer,\n'[39m +
    [32m`\t"status" text DEFAULT 'draft' NOT NULL,\n`[39m +
    [32m'\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n'[39m +
    [32m'\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL\n'[39m +
    [32m');\n'[39m +
    [32m'--> statement-breakpoint\n'[39m +
    [32m'CREATE TABLE "book_tags" (\n'[39m +
    [32m'\t"book_id" uuid NOT NULL,\n'[39m +
    [32m'\t"tag_id" uuid NOT NULL,\n'[39m +
    [32m'\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n'[39m +
    [32m'\tCONSTRAINT "book_tags_book_id_tag_id_pk" PRIMARY KEY("book_id","tag_id")\n'[39m +
    [32m');\n'[39m +
    [32m'--> statement-breakpoint\n'[39m +
    [32m'CREATE TABLE "gadgets" (\n'[39m +
    [32m'\t"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n'[39m +
    [32m'\t"name" text NOT NULL,\n'[39m +
    [32m'\t"category" "gadgets_category_enum" NOT NULL,\n'[39m +
    [32m'\t"weight_gr" integer,\n'[39m +
    [32m'\t"discontinued" boolean,\n'[39m +
    [32m'\t"released_at" timestamp with time zone,\n'[39m +
    [32m'\t"supplier_id" uuid NOT NULL,\n'[39m +
    [32m'\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n'[39m +
    [32m'\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL\n'[39m +
    [32m');\n'[39m +
    [32m'--> statement-breakpoint\n'[39m +
    [32m'CREATE TABLE "suppliers" (\n'[39m +
    [32m'\t"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n'[39m +
    [32m'\t"name" text NOT NULL,\n'[39m +
    [32m'\t"country" text,\n'[39m +
    [32m'\t"rating" integer,\n'[39m +
    [32m'\t"contact_email" text,\n'[39m +
    [32m'\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n'[39m +
    [32m'\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL\n'[39m +
    [32m');\n'[39m +
    [32m'--> statement-breakpoint\n'[39m +
    [32m'CREATE TABLE "tags" (\n'[39m +
    [32m'\t"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n'[39m +
    [32m'\t"label" text NOT NULL,\n'[39m +
    [32m'\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n'[39m +
    [32m'\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL,\n'[39m +
    [32m'\tCONSTRAINT "tags_label_unique" UNIQUE("label")\n'[39m +
    [32m');\n'[39m +
    [32m'--> statement-breakpoint\n'[39m +
    [32m'ALTER TABLE "books" ADD CONSTRAINT "books_author_id_authors_id_fk" FOREIGN KEY ("author_id") REFERENCES "public"."authors"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\n'[39m +
    [32m'ALTER TABLE "book_tags" ADD CONSTRAINT "book_tags_book_id_books_id_fk" FOREIGN KEY ("book_id") REFERENCES "public"."books"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\n'[39m +
    [32m'ALTER TABLE "book_tags" ADD CONSTRAINT "book_tags_tag_id_tags_id_fk" FOREIGN KEY ("tag_id") REFERENCES "public"."tags"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\n'[39m +
    [32m'ALTER TABLE "gadgets" ADD CONSTRAINT "gadgets_supplier_id_suppliers_id_fk" FOREIGN KEY ("supplier_id") REFERENCES "public"."suppliers"("id") ON DELETE cascade ON UPDATE cascade;'[39m,
  params: [],
  cause: PostgresError: type "gadgets_category_enum" already exists
      at ErrorResponse (/Users/elias/Documents/Projects/2025_2026/eDB/node_modules/[4m.pnpm[24m/postgres@3.4.7/node_modules/[4mpostgres[24m/cjs/src/connection.js:794:26)
      at handle (/Users/elias/Documents/Projects/2025_2026/eDB/node_modules/[4m.pnpm[24m/postgres@3.4.7/node_modules/[4mpostgres[24m/cjs/src/connection.js:480:6)
      at Socket.data (/Users/elias/Documents/Projects/2025_2026/eDB/node_modules/[4m.pnpm[24m/postgres@3.4.7/node_modules/[4mpostgres[24m/cjs/src/connection.js:315:Warning: command "node src/lib/db/runMigrations.local.cjs" exited with non-zero status code


 NX   Running target migrate for project workbench-api-infra failed

Failed tasks:

- workbench-api-infra:migrate

Hint: run the command with --verbose for more details.

View structured, searchable error logs at https://nx.app/runs/VzRMxfPtyk


Drop complete. Full log: logs/workbench-gadgets-drop-20251101-125340.log
